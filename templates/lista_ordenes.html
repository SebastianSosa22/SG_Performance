<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Órdenes Registradas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>

<body class="bg-light p-4">
    <div class="container">
        <h2 class="mb-4">Órdenes de Servicio</h2>
        <div class="row align-items-center">
            <div class="col-2">
                <a href="{{ url_for('orden') }}" class="btn btn-primary mb-3">➕ Nueva Orden</a>

                <a href="{{ url_for('auth.logout') }}" class="btn btn-secondary mb-3">Cerrar</a>

            </div>

            <div class="col-10">
                <!-- Barra de búsqueda avanzada -->
                <div class="card mb-3 shadow-sm">
                    <div class="card-body">
                        <form id="searchForm" class="row g-2">
                            <div class="col-md-5">
                                <input type="text" class="form-control" id="buscarCliente"
                                    placeholder="Buscar por Cliente">
                            </div>
                            <div class="col-md-6">
                                <input type="text" class="form-control" id="buscarVehiculo" placeholder="Vehículo">
                            </div>
                            <div class="col-md-1">
                                <button type="button" class="btn btn-secondary"
                                    onclick="limpiarFiltros()">Limpiar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </div>

        <!-- Tabla -->
        <table class="table table-bordered table-striped" id="ordenesTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Cliente</th>
                    <th>Teléfono</th>
                    <th>Vehículo</th>
                    <th>Placas</th>
                    <th>Servicios</th>
                    <th>Ingreso</th>
                    <th>Salida</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for orden in ordenes %}
                <tr>
                    <td>{{ orden.id }}</td>
                    <td>{{ orden.nombre }}</td>
                    <td>{{ orden.telefono }}</td>
                    <td>{{ orden.marca }} {{ orden.modelo }} {{ orden.ano }}</td>
                    <td>{{ orden.placas }}</td>
                    <td>{{ orden.servicios }}</td>
                    <td>{{ orden.ingreso }}</td>
                    <td>
                        {% if orden.salida %}
                        {{ orden.salida }}
                        {% else %}
                        <span class="text-muted">En reparación</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('detalle', orden_id=orden.id) }}" class="btn btn-info btn-sm">
                            <i class="bi bi-search"></i>
                        </a>
                        <a href="{{ url_for('editar_orden', orden_id=orden.id) }}" class="btn btn-warning btn-sm">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <a href="{{ url_for('borrar', orden_id=orden.id) }}" class="btn btn-danger btn-sm"
                            onclick="return confirm('¿Seguro que quieres eliminar esta orden?')">
                            <i class="bi bi-trash"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
        const formInputs = document.querySelectorAll('#searchForm input');
        const rows = document.querySelectorAll('#ordenesTable tbody tr');

        formInputs.forEach(input => {
            input.addEventListener('input', filtrarTabla);
        });

        function filtrarTabla() {
            const cliente = document.getElementById('buscarCliente').value.toLowerCase();
            const placas = document.getElementById('buscarPlacas').value.toLowerCase();
            const vehiculo = document.getElementById('buscarVehiculo').value.toLowerCase();

            rows.forEach(row => {
                const cCliente = row.cells[1].textContent.toLowerCase();
                const cVehiculo = row.cells[3].textContent.toLowerCase();
                const cPlacas = row.cells[4].textContent.toLowerCase();

                let mostrar = true;

                if (cliente && !cCliente.includes(cliente)) mostrar = false;
                if (placas && !cPlacas.includes(placas)) mostrar = false;
                if (vehiculo && !cVehiculo.includes(vehiculo)) mostrar = false;

                row.style.display = mostrar ? '' : 'none';
            });
        }

        function limpiarFiltros() {
            formInputs.forEach(input => input.value = '');
            filtrarTabla();
        }
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Órdenes Registradas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>

<body class="bg-light p-4">
    <div class="container">
        <h2 class="mb-4">Órdenes de Servicio Guardadas</h2>
        <a href="{{ url_for('orden') }}" class="btn btn-primary mb-3">➕ Nueva Orden</a>

        <!-- Barra de búsqueda avanzada -->
        <div class="card mb-4 shadow-sm">
            <div class="card-body">
                <form id="searchForm" class="row g-2">
                    <div class="col-md-3">
                        <input type="text" class="form-control" id="buscarCliente" placeholder="Buscar por Cliente">
                    </div>
                    <div class="col-md-2">
                        <input type="text" class="form-control" id="buscarPlacas" placeholder="Placas">
                    </div>
                    <div class="col-md-2">
                        <input type="text" class="form-control" id="buscarTelefono" placeholder="Teléfono">
                    </div>
                    <div class="col-md-2">
                        <input type="date" class="form-control" id="buscarIngreso">
                    </div>
                    <div class="col-md-2">
                        <input type="date" class="form-control" id="buscarSalida">
                    </div>
                    <div class="col-md-1 d-grid">
                        <button type="button" class="btn btn-secondary" onclick="limpiarFiltros()">Limpiar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabla -->
        <table class="table table-bordered table-striped" id="ordenesTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Cliente</th>
                    <th>Teléfono</th>
                    <th>Vehículo</th>
                    <th>Placas</th>
                    <th>Servicios</th>
                    <th>Ingreso</th>
                    <th>Salida</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for orden in ordenes %}
                <tr>
                    <td>{{ orden.id }}</td>
                    <td>{{ orden.nombre }}</td>
                    <td>{{ orden.telefono }}</td>
                    <td>{{ orden.marca }} {{ orden.modelo }} {{ orden.ano }}</td>
                    <td>{{ orden.placas }}</td>
                    <td>{{ orden.servicios }}</td>
                    <td>{{ orden.ingreso }}</td>
                    <td>
                        {% if orden.salida %}
                        {{ orden.salida }}
                        {% else %}
                        <span class="text-muted">Pendiente</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('detalle', orden_id=orden.id) }}" class="btn btn-info btn-sm">
                            <i class="bi bi-search"></i>
                        </a>
                        <a href="{{ url_for('borrar', orden_id=orden.id) }}" class="btn btn-danger btn-sm"
                            onclick="return confirm('¿Seguro que quieres eliminar esta orden?')">
                            <i class="bi bi-trash"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
        const formInputs = document.querySelectorAll('#searchForm input');
        const rows = document.querySelectorAll('#ordenesTable tbody tr');

        formInputs.forEach(input => {
            input.addEventListener('input', filtrarTabla);
        });

        function filtrarTabla() {
            const cliente = document.getElementById('buscarCliente').value.toLowerCase();
            const placas = document.getElementById('buscarPlacas').value.toLowerCase();
            const telefono = document.getElementById('buscarTelefono').value.toLowerCase();
            const ingreso = document.getElementById('buscarIngreso').value;
            const salida = document.getElementById('buscarSalida').value;

            rows.forEach(row => {
                const cCliente = row.cells[1].textContent.toLowerCase();
                const cTelefono = row.cells[2].textContent.toLowerCase();
                const cPlacas = row.cells[4].textContent.toLowerCase();
                const cIngreso = row.cells[6].textContent;
                const cSalida = row.cells[7].textContent;

                let mostrar = true;

                if (cliente && !cCliente.includes(cliente)) mostrar = false;
                if (placas && !cPlacas.includes(placas)) mostrar = false;
                if (telefono && !cTelefono.includes(telefono)) mostrar = false;
                if (ingreso && !cIngreso.includes(ingreso)) mostrar = false;
                if (salida && !cSalida.includes(salida)) mostrar = false;

                row.style.display = mostrar ? '' : 'none';
            });
        }

        function limpiarFiltros() {
            formInputs.forEach(input => input.value = '');
            filtrarTabla();
        }
    </script>
</body>

</html>
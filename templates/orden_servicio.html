<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Orden de Servicio - Taller</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        .list-group-position {
            position: absolute;
            z-index: 1000;
            width: 100%;
        }
    </style>
</head>

<body class="bg-light p-4">
    <div class="container">
        <h2 class="mb-4">Nueva Orden de Servicio</h2>

        <form method="POST" id="ordenForm">

            <!-- Datos del Cliente -->
            <section class="mb-4">
                <h5>Datos del Cliente</h5>
                <div class="row g-2">
                    <div class="col">
                        <label>Nombre del Cliente</label>
                        <input class="form-control" name="nombre" required>
                    </div>
                    <div class="col">
                        <label>Tel√©fono</label>
                        <input class="form-control" name="telefono">
                    </div>
                </div>
            </section>

            <!-- Datos del Veh√≠culo -->
            <section class="mb-4">
                <h5>Datos del Veh√≠culo</h5>
                <div class="row g-2">
                    <div class="col position-relative">
                        <label>Marca</label>
                        <input type="text" class="form-control" name="marca" id="marcaInput" autocomplete="off"
                            required>
                        <div id="sugerenciasMarca" class="list-group list-group-position"></div>
                    </div>


                    <div class="col position-relative">
                        <label>Modelo</label>
                        <input type="text" class="form-control" name="modelo" id="modeloInput" autocomplete="off"
                            required>
                        <div id="sugerenciasModelo" class="list-group list-group-position"></div>
                    </div>

                    <div class="col">
                        <label>A√±o</label>
                        <input class="form-control" name="ano" autocomplete="off" required>
                    </div>
                </div>

                <div class="row g-2 mt-2">
                    <div class="col">
                        <label>Kilometraje</label>
                        <input class="form-control" name="kilometraje" required>
                    </div>
                    <div class="col">
                        <label>Placas</label>
                        <input class="form-control" name="placas" required>
                    </div>
                    <div class="col">
                        <label>Ingreso en gr√∫a</label>
                        <select class="form-select" name="ingreso_grua" required>
                            <option>No</option>
                            <option>S√≠</option>
                        </select>
                    </div>
                </div>

                <div class="row g-2 mt-2 align-items-end">
                    <div class="col-md-6">
                        <label>VIN</label>
                        <input type="text" class="form-control" name="vin" id="vinInput"
                            placeholder="Ej: WBA3A5106FJ542774">
                    </div>
                    <div class="col-md-6">
                        <button type="button" class="btn btn-primary w-100" id="buscarVin">üîç Buscar VIN</button>
                    </div>
                </div>

                <div class="row g-2 mt-2">
                    <div class="col">
                        <label>Ingreso</label>
                        <input type="date" class="form-control" name="ingreso">
                    </div>
                    <div class="col">
                        <label>Salida</label>
                        <input type="date" class="form-control" name="salida">
                    </div>
                </div>
            </section>

            <!-- Vista previa servicios -->
            <div class="mb-3 p-2 border rounded bg-white">
                <strong>Servicios seleccionados:</strong>
                <div id="serviciosSeleccionados" class="mt-2 text-muted small">Ning√∫n servicio seleccionado</div>
            </div>

            <!-- Buscador -->
            <input type="text" id="buscarServicio" class="form-control mb-3" placeholder="Buscar servicio...">

            <!-- Acorde√≥n -->
            <div class="accordion" id="accordionServicios">
                {% for categoria in categorias %}
                <div class="accordion-item">
                    <h2 class="accordion-header" id="heading{{ categoria.id }}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapse{{ categoria.id }}">
                            {{ categoria.nombre }}
                            <span class="badge bg-primary ms-2 servicio-count" data-categoria="{{ categoria.id }}"
                                style="display:none;">0</span>
                        </button>
                    </h2>
                    <div id="collapse{{ categoria.id }}" class="accordion-collapse collapse"
                        data-bs-parent="#accordionServicios">
                        <div class="accordion-body">
                            <div class="row mb-3 lista-servicios">
                                {% for servicio in categoria.servicios %}
                                <div class="col-md-6 col-lg-4">
                                    <div class="form-check">
                                        <input class="form-check-input servicio-checkbox" type="checkbox"
                                            name="servicios" value="{{ servicio.nombre }}">
                                        <label class="form-check-label">{{ servicio.nombre }}</label>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>

                            <div class="input-group">
                                <input type="text" class="form-control input-servicio-personalizado"
                                    placeholder="Nuevo servicio para {{ categoria.nombre }}">
                                <button type="button" class="btn btn-success btn-agregar-servicio">
                                    <i class="bi bi-plus-circle"></i> Agregar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Otros campos -->
            <textarea class="form-control my-3" name="danos" placeholder="Da√±os Preexistentes"></textarea>
            <textarea class="form-control mb-3" name="observaciones" placeholder="Observaciones"></textarea>
            <textarea class="form-control mb-3" name="realizados"
                placeholder="Servicios Realizados / Refacciones"></textarea>
            <input class="form-control mb-3" name="presupuesto" placeholder="Presupuesto Autorizado">

            <!-- Botones -->
            <a href="{{ url_for('index') }}" class="btn btn-secondary">‚¨Ö Volver</a>
            <button class="btn btn-primary">Guardar</button>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/orden_servicio.js') }}"></script>
</body>

</html>